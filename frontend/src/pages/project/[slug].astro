---
import { Badge } from '@/components/ui/badge'
import type { InferGetStaticPropsType, GetStaticPaths } from 'astro'
import { q } from 'groqd'
import { runQuery, projectSingleSelection } from './../../lib/project'
import PortableText from '../../components/PortableText.astro'
import BaseLayout from '@/layouts/BaseLayout.astro'
import PortableTextImage from '@/components/PortableTextImage.astro'
import { formatDate } from './../../lib'

export const getStaticPaths = (async () => {
  async function getProjects() {
    return runQuery(
      q('*').filter("_type == 'project'").grab(projectSingleSelection),
    )
  }
  const projects = await getProjects()

  return projects.map((project) => {
    return {
      params: {
        slug: project.slug || '',
      },
      props: { ...project },
    }
  })
}) satisfies GetStaticPaths

type Props = InferGetStaticPropsType<typeof getStaticPaths>

const { ...project } = Astro.props
---

<BaseLayout
  title="Astro Shadcn UI Template"
  description="This template helps you build apps with Astro, Tailwind CSS, and Shadcn UI."
>
  <section class="grid items-center">
    <div class="flex flex-col items-start">
      <div>
        {
          project.title && (
            <h1 class="pb-2 text-3xl font-extrabold leading-tight tracking-tighter md:text-4xl">
              {project.title.toLocaleUpperCase()}
            </h1>
          )
        }
        <div class="mb-8 rounded-md bg-secondary p-2">
          Project created on {formatDate(project.createdAt)}
        </div>
      </div>
      <article
        class="pb-8 text-justify text-base text-muted-foreground paragraph:hyphens-auto anchor:font-medium anchor:underline anchor:underline-offset-4"
      >
        <PortableText portableText={project.body} />
      </article>
      {
        project.skills && (
          <div class="mb-8 flex flex-wrap gap-2">
            {project.skills.map((skill) => (
              <Badge className="transition-none" variant="secondary">
                {skill.title}
              </Badge>
            ))}
          </div>
        )
      }
      {
        project.mainImage && (
          <PortableTextImage
            asset={project.mainImage.asset}
            class="mb-8 aspect-video w-full rounded-lg object-cover "
          />
        )
      }
    </div>
  </section>
</BaseLayout>
