---
import { q } from 'groqd'
import { pageProjectSelection } from './../lib/project'
import BaseLayout from '@/layouts/BaseLayout.astro'
import { runQuery } from './../lib/project'
import PageProjectCard from '../components/PageProjectCard.astro'

async function getProjects() {
  return runQuery(
    q('*', { isArray: true })
      .filter("_type == 'project' && defined(slug)")
      .grab$(pageProjectSelection)
      .order('createdAt desc'),
  )
}

const projects = await getProjects()
---

<BaseLayout
  title="Astro Shadcn UI Template"
  description="This template helps you build apps with Astro, Tailwind CSS, and Shadcn UI."
>
  <section class="flex flex-col pb-8 pt-12 md:py-20">
    <div class="flex flex-col items-start gap-2 pb-8 md:pb-20">
      <h1
        class="text-3xl font-extrabold leading-tight tracking-tighter md:text-4xl"
      >
        PROJECTS
      </h1>
      <p class="hyphens-auto text-justify text-base text-muted-foreground">
        As a web developer, I've spent countless hours researching, testing, and
        trying various technologies and stacks. I've been constantly improving
        my skills and abilities, attempting to stay current with the web, so
        here's a live snapshot of my work since I began my adventure in 2018.
        From WordPress to React, as well as Node, Astro, and PHP.
      </p>
    </div>
    {
      projects.length && (
        <div class="grid grid-cols-1 gap-5 sm:grid-cols-1 md:grid-cols-2">
          {projects.map((project) => (
            <PageProjectCard project={project} />
          ))}
        </div>
      )
    }
  </section>
</BaseLayout>
